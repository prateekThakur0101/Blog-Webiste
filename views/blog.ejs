<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head')%>
  <title><%= blog.title %> - Blogify</title>
</head>
<body>
  <%- include('./partials/nav')%>

  <div class="container my-5">
    <!-- Blog Header -->
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="blog-header text-center mb-5">
          <h1 class="blog-title fade-in-up"><%= blog.title %></h1>
          <div class="author-info fade-in-up" style="animation-delay: 0.2s;">
            <img src="<%= blog.createdBy.profileImageURL %>" alt="<%= blog.createdBy.fullName %>" class="author-avatar" width="60" height="60">
            <div>
              <div class="author-name"><%= blog.createdBy.fullName %></div>
              <small class="text-muted">
                <i class="bi bi-calendar3 me-1"></i>
                <%= new Date(blog.createdAt).toLocaleDateString('en-US', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                }) %>
              </small>
            </div>
          </div>
        </div>
        
        <!-- Blog Image -->
        <div class="text-center mb-5 fade-in-up" style="animation-delay: 0.4s;">
          <img src="<%= blog.coverImageUrl %>" alt="<%= blog.title %>" class="blog-image img-fluid" style="max-height: 500px; width: 100%; object-fit: cover;" />
        </div>
        
        <!-- Blog Content -->
        <div class="blog-content fade-in-up" style="animation-delay: 0.6s;">
          <p style="white-space: pre-line;"><%= blog.body %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="comments-section">
          <h3 class="mb-4">
            <i class="bi bi-chat-dots me-2"></i>
            Comments (<%= comments.length %>)
          </h3>
          
          <!-- Add Comment Form -->
          <% if (locals.user) { %>
            <form action="/blog/comment/<%= blog._id %>" method="post" class="mb-4">
              <div class="d-flex gap-3 align-items-start">
                <img src="<%= user.profileImageURL %>" alt="<%= user.fullName %>" class="author-avatar flex-shrink-0" width="40" height="40">
                <div class="flex-grow-1">
                  <div class="form-floating mb-3">
                    <textarea name="content" class="form-control" placeholder="Share your thoughts..." id="commentTextarea" style="height: 100px; resize: none;" required></textarea>
                    <label for="commentTextarea">Share your thoughts...</label>
                  </div>
                  <button class="btn btn-modern" type="submit">
                    <i class="bi bi-send me-2"></i>Post Comment
                  </button>
                </div>
              </div>
            </form>
          <% } else { %>
            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle me-2"></i>
              <a href="/user/signin" class="alert-link">Sign in</a> to join the conversation and share your thoughts!
            </div>
          <% } %>
          
          <!-- Comments List -->
          <% if (comments.length === 0) { %>
            <div class="text-center py-5">
              <i class="bi bi-chat display-4 text-muted mb-3"></i>
              <h5 class="text-muted">No comments yet</h5>
              <p class="text-muted">Be the first to share your thoughts!</p>
            </div>
          <% } else { %>
            <div class="mt-4">
              <% comments.forEach((comment, index) => { %>
                <div class="comment-item fade-in" style="animation-delay: <%= index * 0.1 %>s;">
                  <div class="comment-author mb-2">
                    <img src="<%= comment.createdBy.profileImageURL %>" alt="<%= comment.createdBy.fullName %>" class="author-avatar" width="35" height="35">
                    <div>
                      <strong class="text-dark"><%= comment.createdBy.fullName %></strong>
                      <small class="text-muted ms-2">
                        <i class="bi bi-clock me-1"></i>
                        <%= new Date(comment.createdAt).toLocaleDateString() %>
                      </small>
                    </div>
                  </div>
                  <div class="comment-content">
                    <%= comment.content %>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <!-- Related Posts Section -->
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h4 class="mb-4">Continue Reading</h4>
        <a href="/" class="btn btn-outline-primary">
          <i class="bi bi-arrow-left me-2"></i>Back to All Stories
        </a>
      </div>
    </div>
  </div>

  <%- include('./partials/footer')%>
  <%- include('./partials/scripts')%>
</body>
</html>
